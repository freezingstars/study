# 计算机网络

### 概念

计算机网络(Computer networking)是一个将众多**分散的**，**自治的**计算机系统，通过通信设备与线路连接起来，由功能完善的软件实现**资源共享**和**信息传递**的系统

计算机网络(简称网络)：由若干节点（node）和连接这些节点的线路（link）组成，节点可以使计算机，集线器，交换机，路由器等

集线器（hub）：可以把多个节点连接起来，组成一个计算机网络。普通民用领域已经很少使用集线器，工作在**物理层**。总线拓扑型以广播方式通信，同一时刻仅两个端口通信，半双工传输

交换机（switch）：可以将多个节点连接起来，组成计算机网络，家庭、公司、学习常用交换机组建内部网络，工作在**数据链路层**，通道相互独立全双工通信

路由器（router）：可以把两个或多个计算机网络互相连接起来，形成规模更大的计算机网络“互连网”，工作在**网络层**

家用路由器和传统路由器有一定区别，家用路由器=路由器+交换机+其他功能

ISP ：Internet Service Provider,即**互联网服务提供商**

互连网（因特网），由各大ISP和国际机构组件的，覆盖全球范围的互连网（internet）

小写字母开头的internet（互连网）是个通用名词，泛指多个计算机网络互连而成的计算机网络，对网络间的协议没有要求。

大写字母开头的（互联网）是个专有名词，指全球范围的众多网络互连而成的特定的互连网，它采用TCP/IP协议族。

### 计网的组成和功能
每个网络内部可能使用：集线器、交换机、路由器、调制解调器、无线基站、网线、光纤等各种设备或线路。

​	 - 主机（端系统、end system）电脑、手机、物联网设备

硬件  - 通信设备 集线器、交换机、路由器

​	 - 通信链路 网线、光纤、同轴电缆

软件  - 方便用户使用，实现资源共享。如：Email客户端、聊天软件、网盘软件

协议  - 规定计算机网络中的通信规则 

​	 - 由硬件、软件共同实现  网络适配器+软件 实现网络通信协议

硬件内部安装网络适配器（网卡），网卡再配合软件协议实现网络通信协议。网卡负责交换主机和网络的数据

无线网络适配器通常集成在主板上

从工作方式看，计算机网络主要分为**边缘部分**与**核心部分**.核心部分实现网络连通性与资源交换服务，边缘部分则是各种用户设备，例如服务器与主机。交换服务的核心是路由器

从逻辑功能看，主要分为**资源子网**与**通信子网**
资源子网：计算机网络中运行应用程序，向用户提供可共享的硬件、软件和信息资源的部分。主要由连接到互联网上的主机组成
通信子网：负责信息传输的部分，即所有互联的通信设备与介质的总称，主要由通信链路+通信设备+协议构成。*主机内部实现信息传输的网络适配器、底层协议属于通信子网的范畴*

功能上主要为：**数据通信**，资源共享，分布式处理，提高可靠性，负载均衡，其他（生活，娱乐）

### 交换
交换技术：**电路 报文 分组**，分别对应电话网络，电报网络，现代计算机网络
电路交换(Circuit Switching)：通过物理线路的连接，**动态分配**传输线路资源，**专用**物理链路，**始终**占用端到端线路资源，数据直送，传输效率**高**适合*低频次连接，大量传输数据*。
缺点：
- 建立/释放连接需要**额外的时间开销**。
- 线路被通信双方**独占**，**利用率低**。
- 线路分配的**灵活性差**。交换节点**不支持“差错控制”**（无法发现传输过程中发生的数据错误）

报文交换：
报文存储在交换设备内存中，交换设备内建路径表，优先选择通路。报文附带发送方和接收方信息
优点：
- 通信前**无需建立连接**，仅需要将文件上传至报文网络
- 数据以“报文”为单位在被交换节点间“**存储转发**”，通信线路可以**灵活分配**
- 在通信时间内，两个用户**无需独占**一整条物理线路。相比于电路交换，**线路利用率高**
- 交换节点**支持“差错控制”**（通过校验技术）

缺点：
- 报文**不定长**，不方便存储转发管理
- 长报文的存储转发**时间开销大、缓存开销大**
- 长报文容易出错，重传**代价高**

分组交换：
将不定长的报文转换为定长的分组，在每一段分组中加入相同的header控制信息（源、地址、目的地址、分组号等）。
报文（Message），分组、包（Packet），首部、头信息（Header）.
优点：
- 通信前无需建立连接
- 以“分组”为单位在被交换节点中“存储转发”，通信线路可以灵活分配
- 在通信时间中，两个用户无需独占一整条物理线路。相比于电路交换，线路利用率高。
- 交换节点支持“差错控制”（通过校验技术）

改进：
- 分组**定长，方便存储转发管理**
- 分组的存储转发时间开销小、缓存开销小
- 分组不易出错，重传代价低

缺点：
- 相比于报文交换，控制信息占比增加
- 相比于电路交换，依旧存在存储转发时延
- 报文被拆分为多个分组，传输过程中可能出现**失序、丢失等**问题，增加处理的复杂度

#### 虚电路交换技术
**虚拟电路**，所以会先建立连接，然后通信，分组按序从既定的线路发送，通信双方不独占线路，释放连接

### 类型
分布范围分类：广(Wide Area Network) 城(Metropolitan Area Network) 局(Local Area Network) 个(Personal Area Network)
传输技术分类：广播式网络 点对点网络
拓扑结构分类：[总线 环形 星形]常见于局域网 网状
按使用者分类：公用网 专用网
传输介质分类：有线网络 无线网络
城域网和广域网通常采用以太网技术，个域网通常是通过无线技术连接的网络，因此常称为无线个域网。局域网几乎都是采用**以太网**技术，平时所说的基本也都是以太网交换机
广播式网络发送数据分组时，广播范围内所有计算机都会收到该分组，并通过检查分组目的地址决定是否接受该分组，点对点(p2p)网络则精准送达
总线结构数据广播式传播，存在总线占用的问题
集线器时期主要使用令牌环网技术，以太网交换机发明后以太网技术取得统治地位

### 计网性能指标
- 速率、带宽、吞吐量
- 时延、时延带宽积、往返时延
- 信道利用率
**信道**（Channel）：表示向某一方向传送信息的通道（信道!=通信线路），一条通信线路在逻辑上往往对应一条**发送信道**和一条**接收信道**
**速率**（Speed）：指连接到网络上的节点在信道上传输数据的速率，也称**数据率**或**比特率**、**数据传输速率**
速率单位：bit/s，或b/s，或bps（bit per second）;小b比特，大B字节，1B=8b , 1MB/s = 8Mbps
数量前缀：k（千）M（兆）G（吉）T（太），传输速率是10^3为单位递增，大小是1024
带宽（bandwidth）：某信道所能传送的最高数据率,传输时遵循**木桶效应**，速率最低的一方决定了双方传输速度的上限
在《计算机网络》中：带宽（bandwidth）表示信道所能通过的“最高数据率”。在《通信原理》中：带宽表示某信道允许通过的信号频带范围。单位Hz赫兹，可以加上数量前缀k、M、G、T
光纤的带宽约500Mhz，电话线的带宽约3kHz
吞吐量（Throughput）：指单位时间内通过某个网络（或信道、接口）的实际数据量（**实际的综合数据率**），吞吐量受带宽限制、受复杂的网络负载情况影响
点对点传输：**网线吞吐量=信道吞吐量总和=网卡吞吐量**

#### 时延
时延（Delay）：指数据（一个报文或分组，甚至比特）从网络（或链路）的一端传送到另一端所需的时间，有时也称为延迟或迟延
总时延 = 发送时延 + 传播时延 + 处理时延 + 排队时延
发送时延又称作传输时延，指节点将数据推向信道所花的时间，发送时延=数据长度(bit)/发送速率(bit/s)
传播时延指电磁波在信道中传播一定距离所花的时间，传播时延=信道长度(m)/传播速度(m/s)
处理时延和排队时延指从数据**排队进入**路由器**被路由器处理**所花的时间（分析首部、查找存储转发表）到**排队发出**所花的时间
**时延带宽积**=传播时延\*带宽 = (bit/s)
含义：一条链路中**从发送端发出但尚未到达接收端**的最大比特数，可以理解为求水管容积



#### 往返时延

往返时延RTT（Round-Trip time）：表示从发送方发送完数据，大批发送方收到来自接收方的确认总共经历的时间

#### 信道利用率

指某个信道有百分之多少的时间是有数据通过的（使用时间/总时间），利用率太低浪费资源，利用率过高容易网络堵塞

### 计算机网络的分层结构

这些结构需要完成：差错控制、流量控制、分段和重装、复用和分用、连接建立和释放
被复用的主要功能：**差错控制，流量控制，连接管理，可靠传输管理**

由浅到深可简单分为物理层、数据链路层、网络层、传输层、应用层 ；交换设备主要负责主机和主机之间的物理层、数据链路层和网络层，建立起连接后由主机与主机处理传输层和应用层。**分层结构的设计并不唯一**，可以根据实际需求增加或减少层次。**同一个功能可以在不同层次中反复出现**。

OSI参考模型为7层（法律上的标准）：

- 应用层
- 表示层
- 会话层
- 传输层
- 网络层
- 数据链路层(会给信息加上头尾）
- 物理层  

对于实际标准TCP/IP 模型，仅有四层：应用层（包含应用、表示和会话） 传输层 **网际层** 网络接口层（包含数据链路层和物理层）
教学用标准模型为五层：应用层（包含应用、表示和会话） 传输层 网络层 数据链路层 物理层

网际层并不在OSI标准模型中，他负责的主要是**不同网络之间的通信**，这主要也是TCP/IP主要负责的功能 
 
计算机网络的体系结构（Network Architecture）事实上是计算机网络各层及其协议的**集合**。就是这个计算机网络及其构建所应完成的**功能的精准定义**（不设计实现）
实现（implement）是遵循这种体系结构的前提下，用何种硬件或软件完成这些功能的问题。
体系结构很**抽象**，但实现则是**具体**的
**实体**：在计算机网络的分层结构中，第n层中的活动元素（硬件+软件）通常称为第n层实体，不同机器上的同一层称为***对等层***，同一层的实体称为***对等实体***。
**协议**，即 网络协议（Network Protocol），是控制对等实体之间进行通信的规则的集合，是水平的
**接口**：即同一节点内***相邻两层的实体***交换信息的逻辑接口，又称为**服务访问点**（Service Access Point，SAP）
**服务**：服务是指***下层为紧邻的上层***提供的功能调用，它是垂直的。（应用层为传输层提供应用服务，这是可能对的吗？）
：网络结构内每一层都可以认为是**实体**，**相邻两层**通过逻辑**接口**进行信息交换，下层通过服务为**相邻上层**提供功能调用
不同类型的节点，实现功能的方式可能不一样

从逻辑层面看，数据传输过程从自己的主机 应用层>传输层>网络层>数据链路层>物理层 由此离开主机进入传输介质通向路由器，再到另一方的电脑上过程反向还原。
数据的压缩一般是**YSCS协议**，发送方将数据压缩后{应用层功能}，需要增添首部（head），标识采用的压缩算法；接收方根据标识信息选择解压缩算法将数据解压。
首部的大小、具体格式需要在协议中明确规定。

协议数据单元（PDU）：对等层次之间传送的数据单位
服务数据单元（SDU）：为完成上一层实体所要求的功能而传输的数据
协议控制信息（PCI）：控制协议操作的信息
上述都可以记为n-XXX，标识第几层的XXX（PDU/SDU/PCI)
三者的关系为**n-SDU + n-PDU = n-PDU = (n-1)-SDU**协议控制信息+协议数据单元=该层务数据单元=下一层的服务数据单元；或该层的协议数据单元=上一层传递的服务数据单元+本层的协议控制信息.

#### OSI参考模型详述

物理层的任务是实现相邻节点间比特传输，需要**定义接口参数和传输信号的含义/电气特征等**，物理传输媒体（光线等）算第0层，可以认为物理层是调制解调器这类

数据链路层确保相邻节点之间的链路逻辑上无差错，包含有：差错控制，流量控制。链路层之间的传输单位是帧。通过添加与检验头文件来控制差错，协调流量传输速率是为了照顾双方设备（木桶效应）

网络层把“分组”从源节点转发到目的节点。在该层，传输的单位是**分组（packet）**，又称数据报。包含以下功能：
- **路由选择**：构造并维护路由表，决定分组到达目的节点的最佳路径
- 分组转发：将“分组”从合适的端口转发出去
- 拥塞控制：发现网络拥塞，并采取措施缓解拥塞
- 网际互联：实现异构网络互联
- *差错控制、流量控制、连接的建立与释放（确保分组到达有序和不重复）、可靠传输管理（接收方需返回分组确认消息）*

传输层：实现端到端通信，即进程到进程的通信，端指端口。进程占用不同的端口号，要求网络层的服务，向另一个主机的端口通信，在这一层的传输单位为报文
- **复用和分用**：发送端几个高层实体复用一条低层的连接，在接收端再进行分用
- *差错控制、流量控制、连接的建立与释放、可靠传输管理（**都以报文为单位**）*

会话层：进程间的会话管理，拥有类似断点续传的机制，通信失效时从检查点恢复通信
表示层：解决不同主机上信息表示不一致的问题，主要是数据格式转换（编码，解压缩）
应用层：实现特定的网络应用，根据实际需求设计

#### TCP参考模型详述
这个模型只有四层：应用层 传输层 网络层 网络接口层。应用层包含了应用，表示，会话层的功能。网络接口层包含了物理层和数据链路层。
因为并不是所有网络应用都需要数据格式转换和会话管理功能，TCP/IP模型中没有表示层和会话层。如果某些应用**需要使用这两种功能，可以交给应用层的特定协议去使用**。
对于**网络接口层**，TCP/IP协议认为，网络硬件种类繁多，不应该过多的限制主机到网络设备之间的连接方式，所以并不参照传统的OSI模型。TCP/IP只考虑任务是否实现，怎么传输不作规定。所以**TCP/IP具有更强的灵活性与适应性**。
TCP /IP的网络层功能相对简单，并、**不进行差错控制和流量控制**，只是负责交付数据而已，传输层负责网络层原有的功能
#### 常见网络设备功能层次
- 集线器：物理层
- 交换机：物理层 数据链路层
- 路由器：物理层 数据链路层 网络层

#### 传输单位
比特流（物理层）< 帧(Frame) < 分组(Packet) < 报文段(Segment) < 报文(Message)
报文不定长，多个报文段组成报文

### 协议
即网络协议，是水平的，由**语法、语义和同步**三要素组成；语法：数据与控制信息的格式、语义：需要发出何种控制信息，完成何种动作和做出何种回答、同步：通信双方的操作条件，**时序**关系等

## 通信基础
也就相当于**物理层**的详述了
信源：信号的来源，数据的发送方。信宿：信号的接收方。
**数字信号：信号值是离散的  模拟信号：信号值是连续的**，每一个信号为一个**码元**，信号周期可以称为**码元宽度**
若规定电压1为1，-1为0，则在一个信号周期内可能出现两种信号，此时可以认为一个码元携带了一个bit位的数据，也叫**2进制码元**，有几种状态就叫多少进制码元
如果增添更多电压所对应的数据信息，则可以使每个“信号周期”传输更多信息，但相应的需要加强信号功率，同时也提升了对信道的要求
如果一个周期内可能出现k种信号（k进制码元），则**1个码元携带=log₂K bit**
波特率：每秒传输几个码元，单位是码元/秒或波特(Baud)
比特率：每秒传输几个比特，单位是bit/s, b/s, bps
波特率和码元的互换需要具体数值，波特率\*(码元携带的比特数)=比特率
换成数学式则：若一个码元携带n比特数据量，则波特率 M Baud 对应的比特率为 Mn b/s

计网中带宽（bandwidth）表示信道能通过的**最高数据率**，通信原理中表示**允许通过的信号频带范围**，本质上描述的都是**信道传输数据能力的大小**

#### 噪声
对信道产生干扰，影响信道的数据传输效率。例如强电压，电磁场之类。
##### 奈奎斯特定理：
对于一个**理想低通信道**（无噪声、带宽有限的信道）
极限波特率=2W （单位：波特，即 码元/秒）
W是信道的频率带宽（单位：Hz）
极限比特率=2W log₂K b/s

如果波特率太高，会导致“码间串扰”，即接收方无法识别码元；带宽越大，信道传输码元的能力越强；该定理并未对一个码元可以携带多少比特做出解释

##### 香农定理
对于一个有**噪声、带宽有限**的信道
极限比特率= Wlog₂(1+S/N) b/s    **S/N=信噪比=信号的功率/噪声的功率**；无单位记法下信噪比数字会非常大，采用分贝记法时，信噪比=10log₁₀S/N dB

使用香农定理**计算**信道的极限比特率时，**“信噪比”应采用“无单位记法”**

提升信道带宽、加强信号功率、降低噪声功率，都可以提高信道的极限比特率
结合奈奎斯特定理可知，在带宽、信噪比确定的信道上，一个码元可以携带的比特数是有上限的。

### 编码与调制
#### 概念
二进制数据通过编码为数字信号，再调制成模拟信号
反向则是解调与解码，光猫（调制解调器）可以将二进制数值调制成在光纤中传输的光信号。

#### 常用编码方法
非归零编码(NRZ)：高低电位，单时间周期单信号
归零编码(RZ)：高低电位，单时间周期双信号（第二个信号位归零）
反向非归零编码(NRZI)：1不变0跳变，单时间周期单信号
曼彻斯特编码：高低电位，单时间周期双信号
差分曼彻斯特编码：高低电位，单时间周期双信号
![编码图](image/常用编码图.png "编码图")
非归零编码没有传递周期信息，当传输时间过长后会产生偏差，所以后续的编码方法采取归零的方式作为周期特征。
曼彻斯特编码看中间，如果一个周期内信号电压差是 下跳 从高到低为1，上跳 从低到高为0。差分曼彻斯特编码看起点，传输1时不跳变（高低高低高低），0跳变

非归零编码：无自同步能力，不浪费带宽，弱抗干扰
归零编码：有自同步能力，浪费带宽，弱抗干扰
反向非归零编码：增加冗余位可支持自同步（一般每8个比特位增加一个冗余位），浪费一点宽带，弱抗干扰能力
曼彻斯特编码：有自同步能力，浪费宽带，强抗干扰能力。
差分曼彻斯特编码：有自同步能力，浪费宽带，强抗干扰能力

#### 常用的调制方法

调幅(AM)
调频(FM)
调相(PM)
正交幅度调制(QAM)